# Litestar Vite Reference

> Integration layer connecting Litestar (Python) with Vite (Node.js).
> Supports SPA, Template (Jinja), and Inertia.js workflows.

Current Version: **v0.15.0-alpha.5**
Source: https://github.com/litestar-org/litestar-vite
Docs: https://litestar-org.github.io/litestar-vite/latest/

## Installation

```bash
# Python
pip install litestar-vite
# Extras: [jinja], [http2], [nodeenv]

# Frontend
litestar assets install
```

## Python API

### `ViteConfig`
Root configuration object passed to `VitePlugin`.

```python
from litestar_vite import ViteConfig, RuntimeConfig, PathConfig

config = ViteConfig(
    mode="spa",           # "spa", "template", "htmx", "hybrid", "ssr", "external"
    dev_mode=True,        # Enable HMR/Watch
    base_url="/static/",  # CDN/Asset URL
    paths=PathConfig(
        root=".",
        bundle_dir="public",
        resource_dir="src",
        manifest_name="manifest.json"
    ),
    runtime=RuntimeConfig(
        port=5173,
        host="localhost",
        executor="node",  # "node", "bun", "deno", "yarn", "pnpm"
        proxy_mode="vite" # "vite" (allowlist), "proxy" (blocklist), "direct"
    ),
    # Feature flags (True enables defaults)
    types=True,           # Enable type generation
    inertia=True,         # Enable Inertia.js
    spa=True,             # Enable SPA transformations
    deploy=False          # Enable CDN deployment
)
```

### `VitePlugin`
Main application plugin.

```python
from litestar import Litestar
from litestar_vite import VitePlugin

app = Litestar(plugins=[VitePlugin(config=config)])
```

### `InertiaPlugin`
Inertia.js protocol integration.

```python
from litestar_vite.inertia import InertiaPlugin, InertiaConfig

# Requires SessionMiddleware
app = Litestar(
    plugins=[
        VitePlugin(config=ViteConfig(inertia=True)),
        InertiaPlugin(config=InertiaConfig(
            root_template="index.html",
            spa_mode=False,  # Set True for template-less rendering
            component_opt_keys=("component", "page")
        ))
    ]
)
```

### `ViteSPAHandler`
Handles serving SPA HTML (dev proxying + prod caching).
- **Dev**: Proxies requests to Vite.
- **Prod**: Serves cached `index.html` with injected CSRF/Page Data.
- **Methods**: `get_html()`, `get_html_sync()`.

### `HtmlTransformer`
Utilities for injecting scripts and data into HTML.
- `inject_head_script()`
- `set_data_attribute()`

## TypeScript API

### `litestar-vite-plugin`
Vite plugin for `vite.config.ts`.

```typescript
import litestar from "litestar-vite-plugin";

export default defineConfig({
  plugins: [
    litestar({
      input: ["src/main.ts"],
      assetUrl: "/static/",
      bundleDirectory: "public",
      hotFile: "public/hot",
      types: {
        enabled: true,
        output: "src/generated",
        generateZod: true
      }
    })
  ]
});
```

### Helpers
**`litestar-vite-plugin/helpers`**:
- `route(name, params)`: Generate URL from route name.
- `csrfFetch(url, options)`: `fetch` wrapper with CSRF token.
- `getCsrfToken()`: Get current token.
- `isRoute(name)`: Check current route.

**`litestar-vite-plugin/inertia-helpers`**:
- `resolvePageComponent(path, glob)`: Load component.
- `unwrapPageProps(props)`: Flatten content props (ergonomic access).

### SSR Integrations
- `litestar-vite-plugin/astro`
- `litestar-vite-plugin/sveltekit`
- `litestar-vite-plugin/nuxt`

## CLI Commands (`litestar assets`)

| Command | Description |
|---------|-------------|
| `install` | Install frontend dependencies via executor. |
| `serve` | Run dev server (proxies if configured). |
| `build` | Build frontend assets for production. |
| `init` | Scaffold new frontend (react, vue, svelte, etc.). |
| `doctor` | Diagnose configuration issues. |
| `generate-types` | Generate TypeScript routes and OpenAPI schema. |
| `export-routes` | Export routes.json manually. |
| `deploy` | Upload assets to object storage (s3/gcs). |

## Migration Guide (v0.14 → v0.15)

1. **Proxy Mode**:
   - `proxy_mode="proxy"` (v0.14) → `proxy_mode="vite"` (v0.15) [Default]
   - `proxy_mode="direct"` (v0.14) → `proxy_mode="direct"` (v0.15)
   - New: `proxy_mode="proxy"` now implies *external* dev server (blacklist proxy).

2. **External Dev Server**:
   - Use `ExternalDevServer` config for Angular CLI, Next.js, etc.
   - Example: `runtime=RuntimeConfig(external_dev_server=ExternalDevServer(target="http://localhost:4200"))`.

3. **Inertia**:
   - `spa_mode=True` enables `HtmlTransformer` (no Jinja required).
   - `unwrapPageProps` helper added to JS SDK.

## Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `VITE_DEV_MODE` | Enable development mode | `False` |
| `VITE_PROXY_MODE` | Proxy strategy | `vite` |
| `VITE_HOST` | Dev server host | `localhost` |
| `VITE_PORT` | Dev server port | `5173` |
| `ASSET_URL` | Static asset base URL | `/static/` |
| `VITE_AUTO_DEV_MODE` | Auto-enable dev if no assets | `True` |
