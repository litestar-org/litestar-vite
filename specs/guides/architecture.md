# Architecture Guide for litestar-vite

This document outlines the architectural patterns and conventions used in the `litestar-vite` project.

## Overview

The project follows a hybrid architecture combining a Python backend with a modern TypeScript frontend.

-   **Backend**: Built with [Litestar](https://litestar.dev/), a high-performance, asynchronous ASGI framework.
-   **Frontend**: Managed by [Vite](https://vitejs.dev/), a next-generation frontend build tool.
-   **Integration**: The backend and frontend are connected via a manifest file generated by Vite, allowing the Litestar backend to serve the correct, hash-named JS and CSS assets. The project also includes support for [Inertia.js](https://inertiajs.com/) to build single-page applications with server-side routing.

## Backend Architecture (Python/Litestar)

The backend code is located in `src/py/litestar_vite/`.

### Key Principles

-   **Asynchronous by Default**: All I/O-bound operations (database access, API calls) should be `async` to leverage Litestar's performance benefits.
-   **Dependency Injection**: Litestar's dependency injection is used to manage resources like database sessions and services. Dependencies should be defined in a reusable way.
-   **Configuration**: Configuration is managed through Pydantic models within the `config.py` files, allowing for type-safe and environment-aware settings.

### Component Layers

While not strictly enforced, the backend aims to follow a layered approach:

1.  **Controllers/Route Handlers**: Defined in modules like `plugin.py` or `cli.py`. These are the entry points for HTTP requests or CLI commands. They are responsible for parsing input, calling the relevant services, and returning a response.
2.  **Services**: (Conceptual) Business logic should be encapsulated within service classes or functions. This project may not have explicit `Service` classes, but logic is often grouped by feature (e.g., `loader.py`, `config.py`).
3.  **Data Models / Schemas**: Pydantic or standard dataclasses are used for data validation and serialization.

## Frontend Architecture (TypeScript/Vite)

The core frontend code is located in `src/js/`. The `examples/` directory contains various frontend application examples (Vue, etc.).

### Key Principles

-   **Modularity**: Code is organized into modules and components.
-   **Type Safety**: TypeScript is used throughout to ensure type safety.
-   **Build Optimization**: Vite handles the development server (with HMR) and production builds. The configuration is in `vite.config.ts`.

### Inertia.js Integration

For SPA-style applications, the project uses an Inertia.js integration.

-   The Litestar backend provides an `InertiaPlugin` and `InertiaResponse`.
-   The backend controller returns an `InertiaResponse` with the component name and props.
-   The frontend (e.g., in `examples/inertia/`) uses an Inertia adapter (e.g., for Vue.js) to receive the response and render the correct frontend component without a full page reload.

## Communication

-   **Vite Manifest**: The `ViteAssetLoader` (`loader.py`) reads the `manifest.json` file generated by `vite build`. This manifest maps source asset names to their hashed output filenames.
-   **Dev Server Proxy**: During development, the Litestar application does not serve the assets directly. Instead, it proxies requests to the Vite dev server, enabling Hot Module Replacement (HMR).
-   **API Calls**: For non-Inertia pages, the frontend can make standard RESTful API calls to endpoints exposed by the Litestar backend.
