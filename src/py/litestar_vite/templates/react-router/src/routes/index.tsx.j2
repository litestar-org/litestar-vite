import { useState, useEffect } from "react";

type Summary = {
  app: string;
  headline: string;
  total_books: number;
  featured: {
    id: number;
    title: string;
    author: string;
    year: number;
    tags: string[];
  };
};

function IndexPage() {
  const [summary, setSummary] = useState<Summary | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetch("/api/summary")
      .then((res) => res.json())
      .then((data) => {
        setSummary(data);
        setLoading(false);
      })
      .catch(() => setLoading(false));
  }, []);

  if (loading) {
    return <div className="loading">Loading...</div>;
  }

  if (!summary) {
    return (
      <section className="card">
        <h2>Welcome to {{ project_name }}</h2>
        <p>React + React Router + Litestar + Vite</p>
        <p className="hint">
          Add an API endpoint at <code>/api/summary</code> to see data here.
        </p>
      </section>
    );
  }

  return (
    <section className="card">
      <h2>{summary.headline}</h2>
      <p>Total books: {summary.total_books}</p>
      {summary.featured && (
        <article className="featured">
          <h3>Featured: {summary.featured.title}</h3>
          <p>
            {summary.featured.author} &bull; {summary.featured.year}
          </p>
          <p className="tags">{summary.featured.tags.join(" Â· ")}</p>
        </article>
      )}
    </section>
  );
}

export default IndexPage;
